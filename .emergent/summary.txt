<analysis>**original_problem_statement:**
The user wants to build a full-stack pharmacy inventory management system, Pharmalogy.

**PRODUCT REQUIREMENTS:**
- **Authentication:** JWT-based login/registration with OTP email verification.
- **User Management:** Admins can add/manage users; users can update their own details.
- **Core Workflow:**
    - **Purchases:** Add products with manufacturer, salt, pack type, batch, expiry, etc., using an inline, editable table. User enters MRP(Pack), and MRP/Unit is auto-calculated. Features include auto-save to local storage and smart defaults on .
    - **Inventory:** Track products at a unit level. Display should show both pack and unit counts (e.g., 1 Strip + 5 units). Search by product name or salt composition.
    - **Billing:** Create bills using an inline, editable table. Search inventory by name or salt. Bills must be editable and deletable. Generate PDFs. Features include auto-save and smart defaults.
    - **Customers:** Manage customers and clear outstanding debt.
- **Dashboard:** Analytics, alerts, and sales charts.
- **Data Management:** CSV import, JSON data migration.
- **AI Feature:** A Smart Scanner to add purchases by uploading product photos.
- **UI/UX:**
    - Light and Dark mode theme toggle.
    - Collapsible sidebar.
    - Responsive UI with enhanced search ranking (exact matches first).
    - Keyboard shortcuts for data entry.

**User's preferred language**: English

**what currently exists?**
The project was a complete full-stack application with a FastAPI (Python) backend and a React frontend. All major features were implemented. The user then requested a full backend migration from Python/FastAPI to Node.js/Express to make it a MERN stack application. The agent has scaffolded the new Node.js backend structure and ported the code, but it is not yet running.

**Last working item**:
- **Last item agent was working:** Migrating the entire Python/FastAPI backend to a new Node.js/Express backend. The agent created the  directory, installed all necessary npm packages (, , , , etc.), and ported all existing endpoints, services (PDF, R2, Email), and middleware from the Python  into a modular Node.js structure. The agent is currently blocked trying to run the new Node.js server, as the environment's  configuration is read-only and hardcoded to run the Python  server.
- **Status:** BLOCKED
- **Agent Testing Done:** N
- **Which testing method agent to use?** both. Once the backend is running, it needs a full regression test. Use the  to test all API endpoints for feature parity and perform e2e tests to ensure the frontend works seamlessly with the new backend.
- **User Testing Done:** N

**All Pending/In progress Issue list**:
- **Issue 1: Backend Migration is Blocked (P0)**
    - **Description:** The new Node.js backend cannot be started because the supervisor service () is read-only and configured to run the old Python backend via . The old backend service is currently .
    - **Status:** BLOCKED
    - **Is recurring issue?** N
    - **Next debug checklist:**
        1.  The primary challenge is to run  on port 8001.
        2.  Investigate if a new supervisor config file can be created in . For example, create  to define a new service.
        3.  If creating a new config is not possible, try running the Node.js process in the background using . Check its logs for errors.
        4.  The previous agent tried creating a shim in  and using a wrapper script, both of which were ineffective. Avoid repeating these steps.
    - **Why fix this issue and what will be achieved with the fix?** This is the highest priority blocker. Fixing it will allow the new Node.js backend to run, enabling the completion of the MERN stack migration.
    - **Should Test frontend/backend/both after fix?** both
    - **Blocked on other issue:** N/A

- **Issue 2: Brevo Email Authentication Failure (P2, Recurring)**
    - **Description:** OTP emails fail to send due to a  error. This is a known issue from the Python backend, likely to persist in the Node.js version.
    - **Status:** BLOCKED
    - **Is recurring issue?** Y
    - **Next debug checklist:** Blocked on the user. The user must whitelist the server IP address  in their Brevo account settings.

**In progress Task List**:
- **Task 1: Complete Backend Migration to Node.js/Express (P0)**
    - **Where to resume:** Resume at resolving the Backend Migration is Blocked issue described above. Once the Node.js server is running, the next step is to test connectivity with the MongoDB database and then perform a full API and E2E test.
    - **What will be achieved with this?** A complete MERN stack application, as requested by the user, with all existing features and data preserved.
    - **Status:** BLOCKED
    - **Should Test frontend/backend/both after fix?** both
    - **Blocked on something:** Blocked on running the Node.js server due to environment configuration constraints.

**Upcoming and Future Tasks**
**Upcoming Tasks:**
- **(P1) Role-Based Access Control (RBAC):** Secure API endpoints to enforce  role restrictions.
- **(P1) Admin OTP for New Users:** Send an OTP email to the admin when a new user is created.
- **(P1) Partial Debt Payments:** Allow customers to pay a portion of their outstanding debt.

**Future Tasks:**
- **(P2) AI Business Tips:** Integrate an LLM to provide business insights on the dashboard.
- **(P2) Barcode/QR Scanning:** Integrate for faster billing and purchasing.
- **(P2) Frontend Image Uploads:** Add UI for uploading pharmacy logo and user profile pictures.

**Completed work in this session**
- **Recently completed:**
    - **Feature: MERN Migration (Scaffolding):** Created the full structure for the Node.js/Express backend in , porting all logic from the Python server. (IN PROGRESS)
    - **Feature: User Profile Update UI:** Implemented a complete frontend UI in  for users to update their name/phone with a two-step OTP verification flow. (DONE)
    - **Feature: Enhanced Purchase & Inventory Flow:**
        - Rewrote  to include new fields (Manufacturer, Salt, Pack Type).
        - Implemented auto-save to local storage and a restore draft feature for Purchases and Billing.
        - Implemented smart  key defaults for faster data entry.
        - Updated  to display stock in a X Packs + Y units format. (DONE)
    - **Feature: Collapsible Sidebar:** Implemented a collapsible sidebar in  to maximize content space. (DONE)
    - **Feature: Enhanced Search:** Improved backend search endpoints to query by  and rank exact matches higher. (DONE)
    - **Feature: MRP Calculation Reversal:** Modified  so the user enters  and  is auto-calculated. (DONE)
    - **Testing:** Successfully used  to validate all feature completions prior to the migration request.

**Earlier issues found/mentioned but not fixed**
- **Issue 1: Unresolved Brevo SMTP/API Authentication**
    - **Debug checklist:** User must whitelist server IP  in their Brevo account.
    - **Why to solve this issue and what will be achieved with this?** To enable a professional user registration and profile update experience without workarounds.
    - **Should Test frontend/backend/both after fix:** backend
    - **Is recurring issue?** Y

**Known issue recurrence from previous fork**
- N/A

**Code Architecture**


**Key Technical Concepts**
- **Backend (Migration In Progress):** Node.js, Express.js, Mongoose, JWT (jsonwebtoken), bcrypt, cors, dotenv. Migrating from **Python/FastAPI**.
- **Frontend:** React, React Router, TailwindCSS, Shadcn/UI, Axios.
- **Database:** MongoDB.
- **Architecture:** Migrating from a Python/React stack to a **MERN (MongoDB, Express, React, Node.js)** stack.

**key DB schema**
- **inventory:** 
- **purchases (items sub-doc):** 
- **bills:** 

**changes in tech stack**
- **Complete backend migration from Python/FastAPI to Node.js/Express.**

**All files of reference**
- : The entire directory contains the new, in-progress Node.js backend.  is the entry point.
- : The old Python backend, used as a reference for porting the logic.
- : The read-only supervisor config file that is blocking the new backend from running.

**Areas that need refactoring**:
- The old  directory should be deleted once the Node.js migration is complete and verified.

**key api endpoints**
The API structure is being preserved during the migration. All endpoints (e.g., , , ) will remain the same but will be served by the new Node.js backend.

**Critical Info for New Agent**
- **Your absolute top priority is to get the new Node.js backend running.** You are blocked by a read-only supervisor configuration that is set up for Python. Your first task is to find a way to execute  and make it accessible on port 8001.
- Review the  under  for strategies to solve the supervisor issue.
- Once the server is running, you must conduct a full regression test to ensure all features work as they did on the Python backend. Use the existing frontend to test.
- Do not attempt to modify the old Python code in . All future work should be in .

**documents and test reports created in this job**
- 
- 
- 
-  (updated)

**Last 10 User Messages and any pending HUMAN messages**
1.  **User:** Asks for an overview of the application's tech stack.
2.  **Agent:** Provides a detailed breakdown of the FastAPI/React stack.
3.  **User:** Requests to migrate the entire backend to Node.js/Express, converting it to a MERN application.
4.  **Agent:** Asks for confirmation regarding the migration scope and priorities.
5.  **User:** Confirms the request: convert the entire backend to Express/Node.js, keep all existing data and features, maintain the API structure, and treat it as the highest priority.
6.  **Agent:** Begins the migration process by scaffolding the new  project.
7.  **Agent:** Creates all new route, service, and middleware files, porting logic from Python.
8.  **Agent:** Attempts to reconfigure  but finds the configuration file is read-only.
9.  **Agent:** Tries several workarounds (shim, wrapper script) which fail or time out.
10. **Agent:** Identifies that the old backend service is stopped and the new backend is unable to start, resulting in a blocked state.

**Project Health Check:**
- **Broken:**
    - The entire backend is non-functional due to the incomplete migration.
    - OTP email delivery via Brevo is still non-functional and blocked on user action.
- **Mocked:** N/A

**3rd Party Integrations**
- **Brevo (Email):**  (Node.js) - Requires User API Key and IP whitelisting.
- **Cloudflare R2 (File Storage):**  (Node.js) - Requires User API Keys.
- **Gemini 3 Flash (AI Image Scan):**  - Uses Emergent LLM Key. (Node.js implementation TBD).
- **OpenAI GPT-5.2:** (Node.js implementation TBD).

**Testing status**
- **Testing agent used after significant changes:** YES, all features on the Python stack were thoroughly tested.
- **Troubleshoot agent used after agent stuck in loop:** NO
- **Test files created:** None
- **Known regressions:** The entire application is non-functional as the backend is down during migration.

**Credentials to test flow:**
- **Standard Test User:**
  - **Email:** 
  - **Password:** 

**What agent forgot to execute**
The agent did not forget to execute any tasks. It encountered an environmental limitation (read-only supervisor config) that blocked progress on the user-requested migration.</analysis>
